package mars.ru.des.robot.generator

import java.util.List
import mars.ru.des.robot.taskDSL.Avoid
import mars.ru.des.robot.taskDSL.DriveAction
import mars.ru.des.robot.taskDSL.DriveUntil
import mars.ru.des.robot.taskDSL.Investigate
import mars.ru.des.robot.taskDSL.Object
import mars.ru.des.robot.taskDSL.Speak
import mars.ru.des.robot.taskDSL.Task

class Brick1Generator {

	def static generate(Task task) '''
		#!/usr/bin/env python3
		
		
		def run():
		    for t in tasks:
		        t.execute()
		
		
		print("Starting brick 1")
		tasks = []
		
		
		run()
	'''

	def generateTask(Task task) '''
		Task t1 = Task()
		t1.set_action(«generateAction(task.getAction)»)
		
		«FOR av : task.avoiders»
			t1.add_avoider(«generateAction(av)»)
		«ENDFOR»
	'''

	def dispatch static generateAction(DriveUntil action) '''
		«IF action.getObject() === Object.LAKE»
			ColorFinder(«DslHelper.toString(action.getColor())», «DslHelper.toString(action.getSpeed())»)
		«ELSEIF action.getObject() === Object.ROCK»
			RockFinder(«DslHelper.toString(action.getColor())», «DslHelper.toString(action.getSpeed())»)
		«ENDIF»
	'''

	def dispatch static generateAction(Investigate action) '''
		Investigator(«DslHelper.toString(action.getSpeed())»)
	'''

	def dispatch static generateAction(Speak action) '''
		Speaker("«action.getText()»")
	'''

	def static generateAvoider(Avoid avoid) '''
		«IF avoid.getObject() === Object.LAKE»
			ColorAvoider(«DslHelper.toString(avoid.getColor())», «DslHelper.toString(action.getSpeed())»)
		«ELSEIF avoid.getObject() === Object.ROCK»
			RockAvoider(«DslHelper.toString(action.getSpeed())»)
		«ENDIF»
	'''
	
	def static String toString(List<DriveAction> driveActions) {
		s = "";
		«FOR action : driveActions»
			s += driveActionToString(action) + ""
		«ENDFOR»
		
		return s
	}

	def static String driveActionToString(MoveBack action) {
		return "DriveAction(Speed.NORMAL," + action.getDistance() + ", 0)"
	}

	def static String driveActionToString(Turn action) {
		return "DriveAction(Speed.NORMAL, 0," + action.getDegrees() + ")"
	}

}
